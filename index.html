<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LoL Search Tools - 汎用ツール</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Barlow:wght@700;900&family=Noto+Sans+JP:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Noto Sans JP", sans-serif;
        background: #0a0e27;
        min-height: 100vh;
        padding: 20px;
        overflow-x: hidden;
        position: relative;
      }

      /* アニメーション背景 */
      body::before {
        content: "";
        position: fixed;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
            circle at 20% 50%,
            rgba(120, 119, 198, 0.3) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 80%,
            rgba(88, 101, 242, 0.3) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 20%,
            rgba(255, 115, 230, 0.2) 0%,
            transparent 50%
          );
        animation: gradient 20s ease infinite;
        pointer-events: none;
        z-index: 0;
      }

      @keyframes gradient {
        0%,
        100% {
          transform: translate(0, 0) rotate(0deg);
        }
        33% {
          transform: translate(5%, 5%) rotate(120deg);
        }
        66% {
          transform: translate(-5%, 5%) rotate(240deg);
        }
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        padding: 30px 20px;
        background: rgba(15, 20, 45, 0.8);
        border-radius: 20px;
        backdrop-filter: blur(10px);
        border: 2px solid rgba(120, 119, 198, 0.3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      h1 {
        font-family: "Barlow", sans-serif;
        font-size: 3.5rem;
        font-weight: 900;
        background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 15px;
        text-transform: uppercase;
        letter-spacing: 3px;
        animation: glow 2s ease-in-out infinite;
      }

      @keyframes glow {
        0%,
        100% {
          filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.5));
        }
        50% {
          filter: drop-shadow(0 0 20px rgba(240, 147, 251, 0.8));
        }
      }

      .subtitle {
        font-size: 1.1rem;
        color: #a0aec0;
        font-weight: 400;
      }

      /* タブナビゲーション */
      .tabs {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .tab-button {
        padding: 15px 30px;
        font-size: 1rem;
        font-weight: 700;
        border: none;
        background: rgba(30, 40, 70, 0.6);
        color: #a0aec0;
        cursor: pointer;
        border-radius: 12px;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
      }

      .tab-button::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transition: left 0.5s;
      }

      .tab-button:hover::before {
        left: 100%;
      }

      .tab-button:hover {
        background: rgba(40, 50, 90, 0.8);
        border-color: rgba(102, 126, 234, 0.5);
        transform: translateY(-2px);
      }

      .tab-button.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #ffffff;
        border-color: rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
      }

      /* タブコンテンツ */
      .tab-content {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      .tab-content.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .content-card {
        background: rgba(20, 30, 60, 0.7);
        border-radius: 20px;
        padding: 30px;
        backdrop-filter: blur(10px);
        border: 2px solid rgba(120, 119, 198, 0.3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        margin-bottom: 30px;
      }

      .info-box {
        background: rgba(88, 101, 242, 0.1);
        border-left: 4px solid #5865f2;
        padding: 15px 20px;
        border-radius: 8px;
        color: #cbd5e0;
        margin-bottom: 25px;
        line-height: 1.6;
      }

      /* 入力フォーム */
      .input-group {
        margin-bottom: 25px;
      }

      label {
        display: block;
        color: #e2e8f0;
        font-weight: 700;
        margin-bottom: 10px;
        font-size: 1rem;
      }

      input[type="text"],
      input[type="number"],
      select,
      textarea {
        width: 100%;
        padding: 12px 16px;
        background: rgba(30, 40, 70, 0.6);
        border: 2px solid rgba(120, 119, 198, 0.3);
        border-radius: 10px;
        color: #ffffff;
        font-size: 1rem;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
      }

      textarea {
        min-height: 150px;
        font-family: "Noto Sans JP", sans-serif;
        resize: vertical;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        background: rgba(40, 50, 90, 0.8);
      }

      /* ボタン */
      button {
        padding: 14px 30px;
        font-size: 1rem;
        font-weight: 700;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #ffffff;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        position: relative;
        overflow: hidden;
      }

      button::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      button:hover::before {
        width: 300px;
        height: 300px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
      }

      button:active {
        transform: translateY(0);
      }

      /* 結果表示 */
      .result,
      .loading,
      .error {
        padding: 20px;
        border-radius: 12px;
        margin-top: 25px;
        font-size: 1rem;
        line-height: 1.6;
      }

      .result {
        background: rgba(72, 187, 120, 0.1);
        border: 2px solid rgba(72, 187, 120, 0.3);
        color: #9ae6b4;
      }

      .loading {
        background: rgba(237, 137, 54, 0.1);
        border: 2px solid rgba(237, 137, 54, 0.3);
        color: #fbd38d;
        display: none;
      }

      .error {
        background: rgba(245, 101, 101, 0.1);
        border: 2px solid rgba(245, 101, 101, 0.3);
        color: #fc8181;
        display: none;
      }

      /* チーム分け結果 */
      .team {
        background: rgba(30, 40, 70, 0.6);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        border: 2px solid rgba(120, 119, 198, 0.3);
      }

      .team h3 {
        color: #667eea;
        margin-bottom: 15px;
        font-size: 1.3rem;
      }

      .team-blue h3 {
        color: #4299e1;
      }

      .team-red h3 {
        color: #f56565;
      }

      .player {
        background: rgba(20, 30, 60, 0.6);
        padding: 12px;
        margin: 8px 0;
        border-radius: 8px;
        border-left: 4px solid #667eea;
      }

      .team-blue .player {
        border-left-color: #4299e1;
      }

      .team-red .player {
        border-left-color: #f56565;
      }

      /* レスポンシブ */
      @media (max-width: 768px) {
        h1 {
          font-size: 2.5rem;
        }

        .tabs {
          gap: 10px;
        }

        .tab-button {
          padding: 12px 20px;
          font-size: 0.9rem;
        }

        .content-card {
          padding: 20px;
        }
      }

      /* モーダル */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        animation: fadeIn 0.3s ease;
      }

      .modal-content {
        position: relative;
        background: rgba(20, 30, 60, 0.95);
        margin: 5% auto;
        padding: 30px;
        border: 2px solid rgba(120, 119, 198, 0.5);
        border-radius: 20px;
        width: 90%;
        max-width: 800px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        animation: slideDown 0.3s ease;
      }

      @keyframes slideDown {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .close {
        color: #a0aec0;
        float: right;
        font-size: 32px;
        font-weight: bold;
        line-height: 1;
        cursor: pointer;
        transition: color 0.3s;
      }

      .close:hover {
        color: #f56565;
      }

      .modal h2 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.8rem;
      }

      .modal-body {
        color: #cbd5e0;
        line-height: 1.8;
      }

      /* ルーン、チャンピオン、アイテム共通スタイル */
      .rune-trees,
      .champions-grid,
      .items-grid {
        display: grid;
        gap: 20px;
      }

      .rune-trees {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }

      .champions-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }

      .items-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }

      /* ルーンビルダー */
      .rune-builder-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      @media (max-width: 1024px) {
        .rune-builder-container {
          grid-template-columns: 1fr;
        }
      }

      .rune-builder-section {
        background: rgba(30, 40, 70, 0.6);
        border-radius: 12px;
        padding: 25px;
        border: 2px solid rgba(120, 119, 198, 0.3);
      }

      .rune-builder-section h3 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.3rem;
      }

      .rune-tree-selector {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
      }

      .rune-tree-option {
        background: rgba(20, 30, 60, 0.6);
        border: 2px solid rgba(120, 119, 198, 0.3);
        border-radius: 12px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
      }

      .rune-tree-option:hover {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.2);
        transform: translateY(-3px);
      }

      .rune-tree-option.selected {
        border-color: #fbbf24;
        background: rgba(251, 191, 36, 0.1);
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
      }

      .rune-tree-option.disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .rune-tree-option-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        margin: 0 auto 10px;
        background: rgba(102, 126, 234, 0.2);
        padding: 10px;
      }

      .rune-tree-option-name {
        font-size: 0.9rem;
        font-weight: 600;
        color: #e2e8f0;
      }

      .rune-slot-selection {
        margin-bottom: 25px;
      }

      .rune-slot-selection h4 {
        font-size: 1rem;
        color: #a0aec0;
        margin-bottom: 12px;
        font-weight: 600;
      }

      .rune-options {
        display: grid;
        gap: 10px;
      }

      .rune-option {
        background: rgba(20, 30, 60, 0.6);
        border: 2px solid rgba(120, 119, 198, 0.3);
        border-radius: 10px;
        padding: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 12px;
        position: relative;
      }

      .rune-option:hover {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.2);
      }

      .rune-option.selected {
        border-color: #fbbf24;
        background: rgba(251, 191, 36, 0.1);
      }

      .rune-option-icon {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        flex-shrink: 0;
      }

      .rune-option-details {
        flex: 1;
      }

      .rune-option-name {
        font-size: 0.95rem;
        font-weight: 600;
        color: #e2e8f0;
        margin-bottom: 4px;
      }

      .rune-option-desc {
        font-size: 0.8rem;
        color: #a0aec0;
        line-height: 1.4;
      }

      .stat-shards-container {
        background: rgba(30, 40, 70, 0.6);
        border-radius: 12px;
        padding: 25px;
        border: 2px solid rgba(120, 119, 198, 0.3);
        margin-bottom: 30px;
      }

      .stat-shards-container h3 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.3rem;
      }

      .stat-shards-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
      }

      @media (max-width: 768px) {
        .stat-shards-grid {
          grid-template-columns: 1fr;
        }
      }

      .stat-shard-category h4 {
        font-size: 1rem;
        color: #a0aec0;
        margin-bottom: 12px;
        text-align: center;
        font-weight: 600;
      }

      .stat-shard-options {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .stat-shard-option {
        background: rgba(20, 30, 60, 0.6);
        border: 2px solid rgba(120, 119, 198, 0.3);
        border-radius: 10px;
        padding: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .stat-shard-option:hover {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.2);
      }

      .stat-shard-option.selected {
        border-color: #fbbf24;
        background: rgba(251, 191, 36, 0.1);
      }

      .stat-shard-option.offense.selected {
        border-color: #ef4444;
        background: rgba(239, 68, 68, 0.1);
      }

      .stat-shard-option.flex.selected {
        border-color: #fbbf24;
        background: rgba(251, 191, 36, 0.1);
      }

      .stat-shard-option.defense.selected {
        border-color: #3b82f6;
        background: rgba(59, 130, 246, 0.1);
      }

      .stat-shard-icon {
        width: 35px;
        height: 35px;
        background: rgba(102, 126, 234, 0.2);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: 700;
        color: #cbd5e0;
        flex-shrink: 0;
      }

      .stat-shard-details {
        flex: 1;
      }

      .stat-shard-name {
        font-size: 0.9rem;
        font-weight: 600;
        color: #e2e8f0;
        margin-bottom: 2px;
      }

      .stat-shard-value {
        font-size: 0.75rem;
        color: #a0aec0;
      }

      .rune-page-controls {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .rune-page-name-input {
        flex: 1;
        min-width: 200px;
        padding: 12px 16px;
        background: rgba(30, 40, 70, 0.6);
        border: 2px solid rgba(120, 119, 198, 0.3);
        border-radius: 10px;
        color: #ffffff;
        font-size: 1rem;
      }

      .rune-page-summary {
        background: rgba(30, 40, 70, 0.6);
        border-radius: 12px;
        padding: 20px;
        border: 2px solid rgba(120, 119, 198, 0.3);
        margin-bottom: 30px;
      }

      .rune-page-summary h3 {
        color: #667eea;
        margin-bottom: 15px;
        font-size: 1.2rem;
      }

      .rune-page-summary p {
        color: #a0aec0;
        margin-bottom: 8px;
        font-size: 0.95rem;
      }

      .saved-rune-pages {
        background: rgba(30, 40, 70, 0.6);
        border-radius: 12px;
        padding: 25px;
        border: 2px solid rgba(120, 119, 198, 0.3);
        margin-bottom: 30px;
      }

      .saved-rune-pages h3 {
        color: #667eea;
        margin-bottom: 20px;
        font-size: 1.3rem;
      }

      .saved-rune-page {
        background: rgba(20, 30, 60, 0.6);
        border: 2px solid rgba(120, 119, 198, 0.3);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .saved-rune-page:hover {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.2);
      }

      .saved-rune-page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .saved-rune-page-name {
        font-size: 1.1rem;
        font-weight: 600;
        color: #e2e8f0;
      }

      .saved-rune-page-actions {
        display: flex;
        gap: 10px;
      }

      .saved-rune-page-actions button {
        padding: 6px 12px;
        font-size: 0.85rem;
      }

      .saved-rune-page-info {
        font-size: 0.85rem;
        color: #a0aec0;
        line-height: 1.5;
      }

      /* ルーンツリー表示用（表示のみモード） */
      .rune-tree {
        background: rgba(30, 40, 70, 0.6);
        border-radius: 12px;
        padding: 20px;
        border: 2px solid rgba(120, 119, 198, 0.3);
        transition: all 0.3s ease;
      }

      .rune-tree:hover {
        border-color: rgba(102, 126, 234, 0.6);
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
      }

      .rune-tree-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid rgba(120, 119, 198, 0.3);
      }

      .rune-tree-icon {
        width: 48px;
        height: 48px;
        border-radius: 8px;
        background: rgba(20, 30, 60, 0.8);
        padding: 8px;
      }

      .rune-tree-name {
        font-size: 1.3rem;
        font-weight: 700;
        color: #e2e8f0;
      }

      .rune-slot {
        margin-bottom: 15px;
      }

      .rune-slot-title {
        color: #a0aec0;
        font-size: 0.9rem;
        margin-bottom: 10px;
        font-weight: 600;
      }

      .rune-items {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .rune-item {
        background: rgba(20, 30, 60, 0.8);
        border: 2px solid rgba(120, 119, 198, 0.3);
        border-radius: 8px;
        padding: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        flex: 1;
        min-width: 80px;
      }

      .rune-item:hover {
        border-color: #667eea;
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .rune-item-icon {
        width: 48px;
        height: 48px;
        margin-bottom: 8px;
        border-radius: 8px;
      }

      .rune-item-name {
        color: #cbd5e0;
        font-size: 0.85rem;
        font-weight: 600;
      }

      /* チャンピオンカード */
      .champion-card {
        background: rgba(30, 40, 70, 0.6);
        border-radius: 12px;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid rgba(120, 119, 198, 0.3);
      }

      .champion-card:hover {
        border-color: #667eea;
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      }

      .champion-card-img {
        width: 100%;
        height: 120px;
        object-fit: cover;
      }

      .champion-card-name {
        padding: 10px;
        text-align: center;
        color: #e2e8f0;
        font-weight: 600;
        font-size: 0.9rem;
      }

      /* アイテムカード */
      .item-card {
        background: rgba(30, 40, 70, 0.6);
        border-radius: 12px;
        padding: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid rgba(120, 119, 198, 0.3);
        text-align: center;
      }

      .item-card:hover {
        border-color: #667eea;
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      }

      .item-card-img {
        width: 64px;
        height: 64px;
        margin: 0 auto 8px;
        display: block;
        border-radius: 8px;
      }

      .item-card-name {
        color: #cbd5e0;
        font-size: 0.85rem;
        font-weight: 600;
        margin-bottom: 5px;
      }

      .item-card-price {
        color: #ffd700;
        font-size: 0.8rem;
        font-weight: 700;
      }

      /* フィルターグループ */
      .filter-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      /* スクロールバーカスタマイズ */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(20, 30, 60, 0.5);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- ヘッダー -->
      <div class="header">
        <h1>🎮 LoL Search Tools</h1>
        <p class="subtitle">League of Legends 汎用ツール</p>
      </div>

      <!-- タブナビゲーション -->
      <div class="tabs">
        <button class="tab-button active" onclick="switchTab('match-history')">
          📊 戦績表示
        </button>
        <button class="tab-button" onclick="switchTab('current-game')">
          🎯 試合情報
        </button>
        <button class="tab-button" onclick="switchTab('balance-teams')">
          ⚖️ 組み分け
        </button>
        <button class="tab-button" onclick="switchTab('runes')">
          🎨 ルーン
        </button>
        <button class="tab-button" onclick="switchTab('champions')">
          🏆 チャンピオン
        </button>
        <button class="tab-button" onclick="switchTab('items')">
          🗡️ アイテム
        </button>
      </div>

      <!-- 戦績表示タブ -->
      <div id="match-history" class="tab-content active">
        <div class="content-card">
          <div class="info-box">
            💡 Riot IDを入力すると、最近の試合戦績を取得します。<br />
            試合モード、チャンピオン、勝敗でフィルタリングできます。
          </div>

          <div class="input-group">
            <label>🎮 Riot ID（例: ゲーム名#タグライン）</label>
            <input
              type="text"
              id="game-riot-id"
              placeholder="例: Hide on bush#KR1"
            />
          </div>

          <div class="filter-group">
            <div class="input-group">
              <label>🎲 試合モード</label>
              <select id="filter-mode">
                <option value="">すべて</option>
                <option value="RANKED">ランク戦</option>
                <option value="ARAM">ARAM</option>
                <option value="CHERRY">アリーナ</option>
                <option value="NORMAL">ノーマル</option>
              </select>
            </div>

            <div class="input-group">
              <label>🦸 チャンピオン</label>
              <select id="filter-champion">
                <option value="">すべて</option>
              </select>
            </div>

            <div class="input-group">
              <label>🏆 勝敗</label>
              <select id="filter-result">
                <option value="">すべて</option>
                <option value="win">勝利のみ</option>
                <option value="loss">敗北のみ</option>
              </select>
            </div>
          </div>

          <button onclick="fetchMatchHistory()">🔍 戦績を取得</button>

          <div class="loading" id="match-loading">⏳ 読み込み中...</div>
          <div class="error" id="match-error"></div>
          <div class="result" id="match-result"></div>
        </div>
      </div>

      <!-- 試合情報タブ -->
      <div id="current-game" class="tab-content">
        <div class="content-card">
          <div class="info-box">
            💡 現在プレイ中のサモナーのRiot
            IDを入力すると、リアルタイムの試合情報を取得します。<br />
            参加しているプレイヤー全員のランク情報が表示されます。
          </div>

          <div class="input-group">
            <label>🎮 Riot ID（例: ゲーム名#タグライン）</label>
            <input
              type="text"
              id="current-game-riot-id"
              placeholder="例: Hide on bush#KR1"
            />
          </div>

          <button onclick="fetchCurrentGame()">🔍 試合情報を取得</button>

          <div class="loading" id="current-loading">⏳ 読み込み中...</div>
          <div class="error" id="current-error"></div>
          <div class="result" id="current-result"></div>
        </div>
      </div>

      <!-- 組み分けタブ -->
      <div id="balance-teams" class="tab-content">
        <div class="content-card">
          <div class="info-box">
            💡
            カスタムゲームに参加する10人のサモナーネームを入力してください。<br />
            ランク情報を基に公平な5vs5のチーム分けを行います。
          </div>

          <div class="input-group">
            <label
              >👥
              プレイヤーリスト（1行に1人、ゲーム名#タグライン形式で入力）</label
            >
            <textarea
              id="balance-players"
              placeholder="例:&#10;Player1#JP1&#10;Player2#JP1&#10;Player3#JP1&#10;...&#10;Player10#JP1"
            ></textarea>
          </div>

          <button onclick="balanceTeams()">⚖️ チームを組み分け</button>

          <div class="loading" id="balance-loading">⏳ 読み込み中...</div>
          <div class="error" id="balance-error"></div>
          <div class="result" id="balance-result"></div>
        </div>
      </div>

      <!-- ルーンタブ -->
      <div id="runes" class="tab-content">
        <div class="content-card">
          <div class="info-box">
            🎨 League of Legendsのルーンページを作成・保存できます。<br />
            メインツリーとサブツリーを選択し、統計シャードを設定してください。
          </div>

          <!-- ルーンページコントロール -->
          <div class="rune-page-controls">
            <input
              type="text"
              id="rune-page-name"
              class="rune-page-name-input"
              placeholder="ルーンページ名を入力..."
              value="新しいルーンページ"
            />
            <button onclick="saveRunePage()">💾 ページ保存</button>
            <button onclick="resetRunePage()">🔄 リセット</button>
            <button onclick="toggleSavedPages()">
              📚 保存済み (<span id="saved-pages-count">0</span>)
            </button>
          </div>

          <!-- 保存済みページ表示エリア -->
          <div id="saved-pages-container" style="display: none">
            <div class="saved-rune-pages">
              <h3>💾 保存済みルーンページ</h3>
              <div id="saved-pages-list"></div>
            </div>
          </div>

          <div class="loading" id="runes-loading">
            ⏳ ルーンデータを読み込み中...
          </div>
          <div class="error" id="runes-error"></div>

          <div id="runes-content" style="display: none">
            <!-- ルーンビルダー -->
            <div class="rune-builder-container">
              <!-- メインツリー -->
              <div class="rune-builder-section">
                <h3>🎯 メインツリー</h3>
                <div
                  class="rune-tree-selector"
                  id="primary-tree-selector"
                ></div>
                <div id="primary-rune-slots"></div>
              </div>

              <!-- サブツリー -->
              <div class="rune-builder-section">
                <h3>⚡ サブツリー</h3>
                <div
                  class="rune-tree-selector"
                  id="secondary-tree-selector"
                ></div>
                <div id="secondary-rune-slots"></div>
              </div>
            </div>

            <!-- 統計シャード -->
            <div class="stat-shards-container">
              <h3>📊 統計シャード</h3>
              <div class="stat-shards-grid" id="stat-shards"></div>
            </div>

            <!-- ページ概要 -->
            <div class="rune-page-summary">
              <h3>📋 ルーンページ概要</h3>
              <div id="rune-page-summary-content">
                <p>メインツリー: <span id="summary-primary">未選択</span></p>
                <p>サブツリー: <span id="summary-secondary">未選択</span></p>
                <p>メインルーン: <span id="summary-primary-runes">0/4</span></p>
                <p>サブルーン: <span id="summary-secondary-runes">0/2</span></p>
                <p>統計シャード: <span id="summary-shards">0/3</span></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- チャンピオンタブ -->
      <div id="champions" class="tab-content">
        <div class="content-card">
          <div class="info-box">
            🏆 全チャンピオンの詳細情報、スキル、ステータスを確認できます。<br />
            チャンピオン名で検索できます。
          </div>

          <div class="input-group">
            <label>🔍 チャンピオン検索</label>
            <input
              type="text"
              id="champion-search"
              placeholder="チャンピオン名で検索..."
            />
          </div>

          <div class="loading" id="champions-loading">
            ⏳ チャンピオンデータを読み込み中...
          </div>
          <div class="error" id="champions-error"></div>
          <div id="champions-grid" style="display: none"></div>
        </div>
      </div>

      <!-- アイテムタブ -->
      <div id="items" class="tab-content">
        <div class="content-card">
          <div class="info-box">
            🗡️ 全アイテムの詳細情報を確認できます。<br />
            価格、マップ、キーワードでフィルタリングできます。
          </div>

          <div class="filter-group">
            <div class="input-group">
              <label>🔍 キーワード検索</label>
              <input
                type="text"
                id="item-search"
                placeholder="アイテム名で検索..."
              />
            </div>

            <div class="input-group">
              <label>💰 最低価格</label>
              <input
                type="number"
                id="item-price-min"
                value="0"
                min="0"
                placeholder="0"
              />
            </div>

            <div class="input-group">
              <label>💰 最高価格</label>
              <input
                type="number"
                id="item-price-max"
                value="10000"
                min="0"
                placeholder="10000"
              />
            </div>

            <div class="input-group">
              <label>🗺️ マップ</label>
              <select id="item-map">
                <option value="11">サモナーズリフト</option>
                <option value="12">ハウリングアビス</option>
                <option value="21">ネクサスブリッツ</option>
              </select>
            </div>
          </div>

          <div class="loading" id="items-loading">
            ⏳ アイテムデータを読み込み中...
          </div>
          <div class="error" id="items-error"></div>
          <div id="items-grid" style="display: none"></div>
        </div>
      </div>

      <!-- モーダル -->
      <div id="detailModal" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal()">&times;</span>
          <h2 id="modal-title"></h2>
          <div class="modal-body" id="modal-body"></div>
        </div>
      </div>
    </div>

    <script>
      const API_KEY = "RGAPI-1ff5ec80-f024-47e4-a1db-3e22b8c7aa7c";
      const DDRAGON_VERSION = "15.1.1";

      // グローバル変数
      let allChampions = [];
      let allItems = [];
      let filteredMatches = [];

      // タブ切り替え
      function switchTab(tabId) {
        const tabs = document.querySelectorAll(".tab-content");
        const buttons = document.querySelectorAll(".tab-button");

        tabs.forEach((tab) => tab.classList.remove("active"));
        buttons.forEach((btn) => btn.classList.remove("active"));

        document.getElementById(tabId).classList.add("active");
        event.target.classList.add("active");
      }

      // モーダル表示
      function showModal(title, body) {
        document.getElementById("modal-title").textContent = title;
        document.getElementById("modal-body").innerHTML = body;
        document.getElementById("detailModal").style.display = "block";
      }

      function closeModal() {
        document.getElementById("detailModal").style.display = "none";
      }

      // モーダル外クリックで閉じる
      window.onclick = function (event) {
        const modal = document.getElementById("detailModal");
        if (event.target === modal) {
          closeModal();
        }
      };

      // ========== 既存の機能（戦績・試合情報・組み分け）==========

      // チャンピオンリスト読み込み（フィルター用）
      async function loadChampions() {
        try {
          const response = await fetch(
            `https://ddragon.leagueoflegends.com/cdn/${DDRAGON_VERSION}/data/ja_JP/champion.json`
          );
          const data = await response.json();

          allChampions = Object.entries(data.data).map(([id, champion]) => ({
            id,
            ...champion,
          }));

          const selectElement = document.getElementById("filter-champion");
          allChampions.forEach((champion) => {
            const option = document.createElement("option");
            option.value = champion.id;
            option.textContent = `${champion.name} (${champion.id})`;
            selectElement.appendChild(option);
          });

          console.log(
            `✅ ${allChampions.length}体のチャンピオンを読み込みました`
          );
        } catch (error) {
          console.error("❌ チャンピオンリストの読み込みに失敗:", error);
        }
      }

      // 戦績取得
      async function fetchMatchHistory() {
        const riotId = document.getElementById("game-riot-id").value.trim();
        const loadingEl = document.getElementById("match-loading");
        const errorEl = document.getElementById("match-error");
        const resultEl = document.getElementById("match-result");

        if (!riotId || !riotId.includes("#")) {
          errorEl.textContent =
            "⚠️ Riot IDを「ゲーム名#タグライン」形式で入力してください";
          errorEl.style.display = "block";
          loadingEl.style.display = "none";
          resultEl.style.display = "none";
          return;
        }

        loadingEl.style.display = "block";
        errorEl.style.display = "none";
        resultEl.style.display = "none";

        const [gameName, tagLine] = riotId.split("#");

        try {
          const response = await fetch(
            `/api/match_history?game_name=${encodeURIComponent(
              gameName
            )}&tag_line=${encodeURIComponent(tagLine)}`
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          loadingEl.style.display = "none";

          if (data.error) {
            errorEl.textContent = `❌ ${data.error}`;
            errorEl.style.display = "block";
            return;
          }

          filteredMatches = data.matches || [];
          displayMatchHistory(filteredMatches);
          resultEl.style.display = "block";
        } catch (error) {
          loadingEl.style.display = "none";
          errorEl.textContent = `❌ エラーが発生しました: ${error.message}`;
          errorEl.style.display = "block";
        }
      }

      // 戦績表示
      function displayMatchHistory(matches) {
        const resultEl = document.getElementById("match-result");

        if (!matches || matches.length === 0) {
          resultEl.innerHTML = "<p>試合データが見つかりませんでした。</p>";
          return;
        }

        let html = `<h3>📊 試合履歴（${matches.length}試合）</h3>`;

        matches.forEach((match, index) => {
          const win = match.win;
          const winClass = win ? "team-blue" : "team-red";
          const winText = win ? "🏆 勝利" : "💀 敗北";

          html += `
            <div class="team ${winClass}" style="margin: 15px 0;">
              <h4>${winText} - ${match.mode} (${match.duration})</h4>
              <div class="player">
                <strong>${match.champion}</strong><br>
                <span style="color: #9ae6b4;">KDA: ${match.kda}</span><br>
                <span>CS: ${
                  match.cs
                } | ダメージ: ${match.damage.toLocaleString()}</span>
              </div>
            </div>
          `;
        });

        resultEl.innerHTML = html;
      }

      // フィルター適用
      function applyFilters() {
        if (!filteredMatches.length) return;

        const mode = document.getElementById("filter-mode").value;
        const champion = document.getElementById("filter-champion").value;
        const result = document.getElementById("filter-result").value;

        let filtered = [...filteredMatches];

        if (mode) {
          filtered = filtered.filter((m) => m.mode === mode);
        }

        if (champion) {
          filtered = filtered.filter((m) => m.champion === champion);
        }

        if (result === "win") {
          filtered = filtered.filter((m) => m.win === true);
        } else if (result === "loss") {
          filtered = filtered.filter((m) => m.win === false);
        }

        displayMatchHistory(filtered);
      }

      // フィルター変更イベント
      document
        .getElementById("filter-mode")
        ?.addEventListener("change", applyFilters);
      document
        .getElementById("filter-champion")
        ?.addEventListener("change", applyFilters);
      document
        .getElementById("filter-result")
        ?.addEventListener("change", applyFilters);

      // 現在の試合情報取得
      async function fetchCurrentGame() {
        const riotId = document
          .getElementById("current-game-riot-id")
          .value.trim();
        const loadingEl = document.getElementById("current-loading");
        const errorEl = document.getElementById("current-error");
        const resultEl = document.getElementById("current-result");

        if (!riotId || !riotId.includes("#")) {
          errorEl.textContent =
            "⚠️ Riot IDを「ゲーム名#タグライン」形式で入力してください";
          errorEl.style.display = "block";
          loadingEl.style.display = "none";
          resultEl.style.display = "none";
          return;
        }

        loadingEl.style.display = "block";
        errorEl.style.display = "none";
        resultEl.style.display = "none";

        const [gameName, tagLine] = riotId.split("#");

        try {
          const response = await fetch(
            `/api/current_game?game_name=${encodeURIComponent(
              gameName
            )}&tag_line=${encodeURIComponent(tagLine)}`
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          loadingEl.style.display = "none";

          if (data.error) {
            errorEl.textContent = `❌ ${data.error}`;
            errorEl.style.display = "block";
            return;
          }

          displayCurrentGame(data);
          resultEl.style.display = "block";
        } catch (error) {
          loadingEl.style.display = "none";
          errorEl.textContent = `❌ エラーが発生しました: ${error.message}`;
          errorEl.style.display = "block";
        }
      }

      // 現在の試合表示
      function displayCurrentGame(data) {
        const resultEl = document.getElementById("current-result");
        const blueTeam = data.participants.filter((p) => p.teamId === 100);
        const redTeam = data.participants.filter((p) => p.teamId === 200);

        let html = `<h3>🎯 試合情報 - ${data.mode}</h3>`;

        html += `<div class="team team-blue"><h3>💙 Blue Team</h3>`;
        blueTeam.forEach((p) => {
          html += `
            <div class="player">
              <strong>${p.riotId}</strong> - ${p.champion}<br>
              <span style="color: #9ae6b4;">${p.rank}</span>
            </div>
          `;
        });
        html += `</div>`;

        html += `<div class="team team-red"><h3>❤️ Red Team</h3>`;
        redTeam.forEach((p) => {
          html += `
            <div class="player">
              <strong>${p.riotId}</strong> - ${p.champion}<br>
              <span style="color: #9ae6b4;">${p.rank}</span>
            </div>
          `;
        });
        html += `</div>`;

        resultEl.innerHTML = html;
      }

      // チーム組み分け
      async function balanceTeams() {
        const playersText = document
          .getElementById("balance-players")
          .value.trim();
        const loadingEl = document.getElementById("balance-loading");
        const errorEl = document.getElementById("balance-error");
        const resultEl = document.getElementById("balance-result");

        if (!playersText) {
          errorEl.textContent = "⚠️ プレイヤーリストを入力してください";
          errorEl.style.display = "block";
          loadingEl.style.display = "none";
          resultEl.style.display = "none";
          return;
        }

        const players = playersText
          .split("\n")
          .map((p) => p.trim())
          .filter((p) => p);

        if (players.length < 10) {
          errorEl.textContent = "⚠️ 10人のプレイヤーを入力してください";
          errorEl.style.display = "block";
          loadingEl.style.display = "none";
          resultEl.style.display = "none";
          return;
        }

        loadingEl.style.display = "block";
        errorEl.style.display = "none";
        resultEl.style.display = "none";

        try {
          const response = await fetch("/api/balance_teams", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ players: players.slice(0, 10) }),
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          loadingEl.style.display = "none";

          if (data.error) {
            errorEl.textContent = `❌ ${data.error}`;
            errorEl.style.display = "block";
            return;
          }

          displayBalancedTeams(data);
          resultEl.style.display = "block";
        } catch (error) {
          loadingEl.style.display = "none";
          errorEl.textContent = `❌ エラーが発生しました: ${error.message}`;
          errorEl.style.display = "block";
        }
      }

      // 組み分け結果表示
      function displayBalancedTeams(data) {
        const resultEl = document.getElementById("balance-result");

        let html = `<h3>⚖️ チーム組み分け結果</h3>`;
        html += `<p>平均スコア差: ${data.score_diff}</p>`;

        html += `<div class="team team-blue"><h3>💙 Team 1 (Score: ${data.team1_score})</h3>`;
        data.team1.forEach((p) => {
          html += `
            <div class="player">
              <strong>${p.riotId}</strong><br>
              <span style="color: #9ae6b4;">${p.rank} (Score: ${p.score})</span>
            </div>
          `;
        });
        html += `</div>`;

        html += `<div class="team team-red"><h3>❤️ Team 2 (Score: ${data.team2_score})</h3>`;
        data.team2.forEach((p) => {
          html += `
            <div class="player">
              <strong>${p.riotId}</strong><br>
              <span style="color: #9ae6b4;">${p.rank} (Score: ${p.score})</span>
            </div>
          `;
        });
        html += `</div>`;

        resultEl.innerHTML = html;
      }

      // ========== 新機能（ルーン・チャンピオン・アイテム）==========

      // ルーンページの状態管理
      let currentRunePage = {
        id: "current",
        name: "新しいルーンページ",
        primaryTreeId: 0,
        secondaryTreeId: 0,
        selectedRunes: {
          primaryRunes: [], // 4つのメインルーン
          secondaryRunes: [], // 2つのサブルーン
        },
        statShards: {
          offense: 0,
          flex: 0,
          defense: 0,
        },
      };

      let runesData = [];
      let savedRunePages = [];

      // 統計シャードデータ (lol-item-searchから移植)
      const STAT_SHARDS = {
        offense: [
          { id: 5005, name: "攻撃速度", value: "+10% 攻撃速度" },
          { id: 5008, name: "適応攻撃力", value: "+9 適応攻撃力" },
          { id: 5007, name: "適応攻撃力", value: "+9 適応攻撃力" },
        ],
        flex: [
          { id: 5008, name: "適応攻撃力", value: "+9 適応攻撃力" },
          { id: 5002, name: "物理防御力", value: "+6 物理防御力" },
          { id: 5003, name: "魔法防御力", value: "+8 魔法防御力" },
        ],
        defense: [
          { id: 5001, name: "体力", value: "+15-140 体力（レベル依存）" },
          { id: 5002, name: "物理防御力", value: "+6 物理防御力" },
          { id: 5003, name: "魔法防御力", value: "+8 魔法防御力" },
        ],
      };

      // HTMLタグをクリーンにする関数（lol-item-searchから移植）
      function cleanLoLText(text) {
        if (!text) return "";

        return text
          .replace(/<br\s*\/?>/gi, "\n")
          .replace(/<\/?li>/gi, "\n• ")
          .replace(/<\/?ul>/gi, "\n")
          .replace(/<\/?ol>/gi, "\n")
          .replace(/<\/p>/gi, "\n")
          .replace(/<[^>]+>/g, "")
          .replace(/&nbsp;/gi, " ")
          .replace(/&lt;/gi, "<")
          .replace(/&gt;/gi, ">")
          .replace(/&amp;/gi, "&")
          .replace(/&quot;/gi, '"')
          .replace(/&#39;/gi, "'")
          .replace(/\n\s*\n/g, "\n")
          .trim();
      }

      // ルーンデータ読み込み
      async function loadRunes() {
        try {
          const response = await fetch(
            `https://ddragon.leagueoflegends.com/cdn/${DDRAGON_VERSION}/data/ja_JP/runesReforged.json`
          );
          runesData = await response.json();

          // ローカルストレージから保存済みページを読み込み
          const saved = localStorage.getItem("runePages");
          savedRunePages = saved ? JSON.parse(saved) : [];
          updateSavedPagesCount();

          // UIの初期化
          renderRuneBuilder();
          renderStatShards();
          updateRunePageSummary();

          document.getElementById("runes-loading").style.display = "none";
          document.getElementById("runes-content").style.display = "block";

          console.log(`✅ ${runesData.length}個のルーンツリーを読み込みました`);
        } catch (error) {
          console.error("❌ ルーンデータの読み込みに失敗:", error);
          document.getElementById("runes-loading").style.display = "none";
          document.getElementById("runes-error").textContent =
            "ルーンデータの読み込みに失敗しました";
          document.getElementById("runes-error").style.display = "block";
        }
      }

      // ルーンビルダーのレンダリング
      function renderRuneBuilder() {
        renderTreeSelector("primary");
        renderTreeSelector("secondary");
        renderPrimaryRuneSlots();
        renderSecondaryRuneSlots();
      }

      // ツリーセレクターのレンダリング
      function renderTreeSelector(type) {
        const container = document.getElementById(
          type === "primary"
            ? "primary-tree-selector"
            : "secondary-tree-selector"
        );
        const selectedTreeId =
          type === "primary"
            ? currentRunePage.primaryTreeId
            : currentRunePage.secondaryTreeId;
        const otherTreeId =
          type === "primary"
            ? currentRunePage.secondaryTreeId
            : currentRunePage.primaryTreeId;

        let html = "";
        runesData.forEach((tree) => {
          const isSelected = tree.id === selectedTreeId;
          const isDisabled = type === "secondary" && tree.id === otherTreeId;
          const iconUrl = `https://ddragon.leagueoflegends.com/cdn/img/${tree.icon}`;

          html += `
            <div 
              class="rune-tree-option ${isSelected ? "selected" : ""} ${
            isDisabled ? "disabled" : ""
          }"
              onclick="${
                isDisabled ? "" : `selectRuneTree('${type}', ${tree.id})`
              }"
            >
              <img src="${iconUrl}" alt="${
            tree.name
          }" class="rune-tree-option-icon">
              <div class="rune-tree-option-name">${tree.name}</div>
            </div>
          `;
        });

        container.innerHTML = html;
      }

      // ツリー選択
      function selectRuneTree(type, treeId) {
        if (type === "primary") {
          if (currentRunePage.primaryTreeId === treeId) return;

          currentRunePage.primaryTreeId = treeId;
          currentRunePage.selectedRunes.primaryRunes = [];

          // サブツリーが同じ場合はリセット
          if (currentRunePage.secondaryTreeId === treeId) {
            currentRunePage.secondaryTreeId = 0;
            currentRunePage.selectedRunes.secondaryRunes = [];
          }
        } else {
          if (currentRunePage.secondaryTreeId === treeId) return;
          if (currentRunePage.primaryTreeId === treeId) return;

          currentRunePage.secondaryTreeId = treeId;
          currentRunePage.selectedRunes.secondaryRunes = [];
        }

        renderRuneBuilder();
        updateRunePageSummary();
      }

      // メインルーンスロットのレンダリング
      function renderPrimaryRuneSlots() {
        const container = document.getElementById("primary-rune-slots");

        if (!currentRunePage.primaryTreeId) {
          container.innerHTML =
            '<p style="color: #a0aec0; text-align: center;">メインツリーを選択してください</p>';
          return;
        }

        const tree = runesData.find(
          (t) => t.id === currentRunePage.primaryTreeId
        );
        if (!tree) return;

        let html = "";
        tree.slots.forEach((slot, slotIndex) => {
          const slotTitle =
            slotIndex === 0 ? "キーストーン" : `スロット ${slotIndex}`;
          const selectedRuneId =
            currentRunePage.selectedRunes.primaryRunes[slotIndex];

          html += `
            <div class="rune-slot-selection">
              <h4>${slotTitle}</h4>
              <div class="rune-options">
          `;

          slot.runes.forEach((rune) => {
            const isSelected = rune.id === selectedRuneId;
            const iconUrl = `https://ddragon.leagueoflegends.com/cdn/img/${rune.icon}`;
            const cleanDesc = cleanLoLText(rune.shortDesc);

            html += `
              <div 
                class="rune-option ${isSelected ? "selected" : ""}"
                onclick="selectPrimaryRune(${slotIndex}, ${rune.id})"
                title="${rune.name}: ${cleanDesc}"
              >
                <img src="${iconUrl}" alt="${
              rune.name
            }" class="rune-option-icon">
                <div class="rune-option-details">
                  <div class="rune-option-name">${rune.name}</div>
                  <div class="rune-option-desc">${cleanDesc.substring(0, 60)}${
              cleanDesc.length > 60 ? "..." : ""
            }</div>
                </div>
              </div>
            `;
          });

          html += `
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
      }

      // サブルーンスロットのレンダリング
      function renderSecondaryRuneSlots() {
        const container = document.getElementById("secondary-rune-slots");

        if (!currentRunePage.secondaryTreeId) {
          container.innerHTML =
            '<p style="color: #a0aec0; text-align: center;">サブツリーを選択してください</p>';
          return;
        }

        const tree = runesData.find(
          (t) => t.id === currentRunePage.secondaryTreeId
        );
        if (!tree) return;

        let html =
          '<p style="color: #a0aec0; margin-bottom: 15px;">以下から2つのルーンを選択してください（キーストーンを除く）</p>';

        // スロット1-3（キーストーンを除く）
        tree.slots.slice(1).forEach((slot, slotIndex) => {
          const actualSlotIndex = slotIndex + 1;

          html += `
            <div class="rune-slot-selection">
              <h4>スロット ${actualSlotIndex}</h4>
              <div class="rune-options">
          `;

          slot.runes.forEach((rune) => {
            const isSelected =
              currentRunePage.selectedRunes.secondaryRunes.includes(rune.id);
            const iconUrl = `https://ddragon.leagueoflegends.com/cdn/img/${rune.icon}`;
            const cleanDesc = cleanLoLText(rune.shortDesc);

            html += `
              <div 
                class="rune-option ${isSelected ? "selected" : ""}"
                onclick="selectSecondaryRune(${rune.id})"
                title="${rune.name}: ${cleanDesc}"
              >
                <img src="${iconUrl}" alt="${
              rune.name
            }" class="rune-option-icon">
                <div class="rune-option-details">
                  <div class="rune-option-name">${rune.name}</div>
                  <div class="rune-option-desc">${cleanDesc.substring(0, 60)}${
              cleanDesc.length > 60 ? "..." : ""
            }</div>
                </div>
              </div>
            `;
          });

          html += `
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
      }

      // メインルーン選択
      function selectPrimaryRune(slotIndex, runeId) {
        currentRunePage.selectedRunes.primaryRunes[slotIndex] = runeId;
        renderPrimaryRuneSlots();
        updateRunePageSummary();
      }

      // サブルーン選択
      function selectSecondaryRune(runeId) {
        const secondaryRunes = currentRunePage.selectedRunes.secondaryRunes;
        const index = secondaryRunes.indexOf(runeId);

        if (index !== -1) {
          // 既に選択されている場合は解除
          secondaryRunes.splice(index, 1);
        } else if (secondaryRunes.length < 2) {
          // 2つ未満の場合は追加
          secondaryRunes.push(runeId);
        } else {
          // 既に2つ選択されている場合は最初のものを置き換え
          secondaryRunes.shift();
          secondaryRunes.push(runeId);
        }

        renderSecondaryRuneSlots();
        updateRunePageSummary();
      }

      // 統計シャードのレンダリング
      function renderStatShards() {
        const container = document.getElementById("stat-shards");
        const categories = [
          { key: "offense", title: "⚔️ 攻撃" },
          { key: "flex", title: "⚡ フレックス" },
          { key: "defense", title: "🛡️ 防御" },
        ];

        let html = "";
        categories.forEach((category) => {
          const shards = STAT_SHARDS[category.key];
          const selectedShardId = currentRunePage.statShards[category.key];

          html += `
            <div class="stat-shard-category">
              <h4>${category.title}</h4>
              <div class="stat-shard-options">
          `;

          shards.forEach((shard) => {
            const isSelected = shard.id === selectedShardId;

            html += `
              <div 
                class="stat-shard-option ${isSelected ? "selected" : ""} ${
              category.key
            }"
                onclick="selectStatShard('${category.key}', ${shard.id})"
              >
                <div class="stat-shard-icon">${shard.name.substring(0, 2)}</div>
                <div class="stat-shard-details">
                  <div class="stat-shard-name">${shard.name}</div>
                  <div class="stat-shard-value">${shard.value}</div>
                </div>
              </div>
            `;
          });

          html += `
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
      }

      // 統計シャード選択
      function selectStatShard(category, shardId) {
        currentRunePage.statShards[category] = shardId;
        renderStatShards();
        updateRunePageSummary();
      }

      // ルーンページ概要の更新
      function updateRunePageSummary() {
        const primaryTree = runesData.find(
          (t) => t.id === currentRunePage.primaryTreeId
        );
        const secondaryTree = runesData.find(
          (t) => t.id === currentRunePage.secondaryTreeId
        );

        document.getElementById("summary-primary").textContent = primaryTree
          ? primaryTree.name
          : "未選択";
        document.getElementById("summary-secondary").textContent = secondaryTree
          ? secondaryTree.name
          : "未選択";

        const primaryCount = currentRunePage.selectedRunes.primaryRunes.filter(
          (r) => r
        ).length;
        const secondaryCount =
          currentRunePage.selectedRunes.secondaryRunes.length;
        const shardsCount = Object.values(currentRunePage.statShards).filter(
          (s) => s > 0
        ).length;

        document.getElementById(
          "summary-primary-runes"
        ).textContent = `${primaryCount}/4`;
        document.getElementById(
          "summary-secondary-runes"
        ).textContent = `${secondaryCount}/2`;
        document.getElementById(
          "summary-shards"
        ).textContent = `${shardsCount}/3`;
      }

      // ルーンページ保存
      function saveRunePage() {
        const name = document.getElementById("rune-page-name").value.trim();

        if (!name) {
          alert("ルーンページ名を入力してください");
          return;
        }

        if (currentRunePage.primaryTreeId === 0) {
          alert("メインツリーを選択してください");
          return;
        }

        const newPage = {
          ...currentRunePage,
          id: Date.now().toString(),
          name: name,
          createdAt: new Date().toISOString(),
        };

        savedRunePages.push(newPage);
        localStorage.setItem("runePages", JSON.stringify(savedRunePages));

        updateSavedPagesCount();
        alert("✅ ルーンページを保存しました！");
      }

      // ルーンページリセット
      function resetRunePage() {
        if (!confirm("ルーンページをリセットしますか？")) return;

        currentRunePage = {
          id: "current",
          name: "新しいルーンページ",
          primaryTreeId: 0,
          secondaryTreeId: 0,
          selectedRunes: {
            primaryRunes: [],
            secondaryRunes: [],
          },
          statShards: {
            offense: 0,
            flex: 0,
            defense: 0,
          },
        };

        document.getElementById("rune-page-name").value = "新しいルーンページ";
        renderRuneBuilder();
        renderStatShards();
        updateRunePageSummary();
      }

      // 保存済みページ表示切り替え
      function toggleSavedPages() {
        const container = document.getElementById("saved-pages-container");
        const isVisible = container.style.display !== "none";

        if (isVisible) {
          container.style.display = "none";
        } else {
          renderSavedPages();
          container.style.display = "block";
        }
      }

      // 保存済みページのレンダリング
      function renderSavedPages() {
        const container = document.getElementById("saved-pages-list");

        if (savedRunePages.length === 0) {
          container.innerHTML =
            '<p style="color: #a0aec0; text-align: center;">保存済みのルーンページがありません</p>';
          return;
        }

        let html = "";
        savedRunePages.forEach((page) => {
          const primaryTree = runesData.find(
            (t) => t.id === page.primaryTreeId
          );
          const secondaryTree = runesData.find(
            (t) => t.id === page.secondaryTreeId
          );

          html += `
            <div class="saved-rune-page" onclick="loadRunePage('${page.id}')">
              <div class="saved-rune-page-header">
                <div class="saved-rune-page-name">${page.name}</div>
                <div class="saved-rune-page-actions" onclick="event.stopPropagation()">
                  <button onclick="loadRunePage('${page.id}')">📥 読込</button>
                  <button onclick="deleteRunePage('${
                    page.id
                  }')">🗑️ 削除</button>
                </div>
              </div>
              <div class="saved-rune-page-info">
                ${primaryTree ? primaryTree.name : "未選択"} / ${
            secondaryTree ? secondaryTree.name : "未選択"
          }
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
      }

      // ルーンページ読み込み
      function loadRunePage(pageId) {
        const page = savedRunePages.find((p) => p.id === pageId);
        if (!page) return;

        currentRunePage = { ...page };
        document.getElementById("rune-page-name").value = page.name;

        renderRuneBuilder();
        renderStatShards();
        updateRunePageSummary();

        document.getElementById("saved-pages-container").style.display = "none";
      }

      // ルーンページ削除
      function deleteRunePage(pageId) {
        if (!confirm("このルーンページを削除しますか？")) return;

        savedRunePages = savedRunePages.filter((p) => p.id !== pageId);
        localStorage.setItem("runePages", JSON.stringify(savedRunePages));

        updateSavedPagesCount();
        renderSavedPages();
      }

      // 保存済みページ数の更新
      function updateSavedPagesCount() {
        document.getElementById("saved-pages-count").textContent =
          savedRunePages.length;
      }

      // チャンピオン一覧読み込み
      async function loadChampionsList() {
        try {
          const response = await fetch(
            `https://ddragon.leagueoflegends.com/cdn/${DDRAGON_VERSION}/data/ja_JP/champion.json`
          );
          const championData = await response.json();

          const champions = Object.entries(championData.data).map(
            ([id, champion]) => ({
              id,
              ...champion,
            })
          );

          window.allChampionsData = champions;
          displayChampions(champions);

          // 検索機能
          document
            .getElementById("champion-search")
            .addEventListener("input", (e) => {
              const searchTerm = e.target.value.toLowerCase();
              const filtered = champions.filter(
                (c) =>
                  c.name.toLowerCase().includes(searchTerm) ||
                  c.id.toLowerCase().includes(searchTerm) ||
                  c.title.toLowerCase().includes(searchTerm)
              );
              displayChampions(filtered);
            });

          document.getElementById("champions-loading").style.display = "none";
          document.getElementById("champions-grid").style.display = "block";

          console.log(`✅ ${champions.length}体のチャンピオンを読み込みました`);
        } catch (error) {
          console.error("❌ チャンピオンデータの読み込みに失敗:", error);
          document.getElementById("champions-loading").style.display = "none";
          document.getElementById("champions-error").textContent =
            "チャンピオンデータの読み込みに失敗しました";
          document.getElementById("champions-error").style.display = "block";
        }
      }

      // チャンピオン表示
      function displayChampions(champions) {
        const container = document.getElementById("champions-grid");
        let html = '<div class="champions-grid">';

        champions.forEach((champion) => {
          const imgUrl = `https://ddragon.leagueoflegends.com/cdn/${DDRAGON_VERSION}/img/champion/${champion.id}.png`;

          html += `
            <div class="champion-card" onclick="showChampionDetail('${champion.id}')">
              <img src="${imgUrl}" alt="${champion.name}" class="champion-card-img">
              <div class="champion-card-name">${champion.name}</div>
            </div>
          `;
        });

        html += "</div>";
        container.innerHTML = html;
      }

      // チャンピオン詳細表示
      async function showChampionDetail(championId) {
        try {
          const response = await fetch(
            `https://ddragon.leagueoflegends.com/cdn/${DDRAGON_VERSION}/data/ja_JP/champion/${championId}.json`
          );
          const data = await response.json();
          const champion = data.data[championId];

          let body = `
            <p><strong>${champion.title}</strong></p>
            <p>${champion.lore}</p>
            <br>
            <p><strong>タイプ:</strong> ${champion.tags.join(", ")}</p>
            <p><strong>難易度:</strong> ${"★".repeat(
              champion.info.difficulty
            )}</p>
            <br>
            <h3>スキル</h3>
          `;

          // パッシブ
          body += `
            <p><strong>パッシブ: ${champion.passive.name}</strong></p>
            <p>${champion.passive.description.replace(/<[^>]*>/g, "")}</p>
            <br>
          `;

          // スキル
          champion.spells.forEach((spell, index) => {
            body += `
              <p><strong>${index + 1}. ${spell.name}</strong></p>
              <p>${spell.description.replace(/<[^>]*>/g, "")}</p>
              <p><em>クールダウン: ${spell.cooldownBurn}秒 | コスト: ${
              spell.costBurn
            }</em></p>
              <br>
            `;
          });

          showModal(champion.name, body);
        } catch (error) {
          console.error("チャンピオン詳細の取得に失敗:", error);
          alert("チャンピオン詳細の取得に失敗しました");
        }
      }

      // アイテム一覧読み込み
      async function loadItemsList() {
        try {
          const response = await fetch(
            `https://ddragon.leagueoflegends.com/cdn/${DDRAGON_VERSION}/data/ja_JP/item.json`
          );
          const itemData = await response.json();

          allItems = Object.entries(itemData.data).map(([id, item]) => ({
            id,
            ...item,
          }));

          displayItems(allItems);

          // フィルター機能
          document
            .getElementById("item-search")
            .addEventListener("input", filterItems);
          document
            .getElementById("item-price-min")
            .addEventListener("input", filterItems);
          document
            .getElementById("item-price-max")
            .addEventListener("input", filterItems);
          document
            .getElementById("item-map")
            .addEventListener("change", filterItems);

          document.getElementById("items-loading").style.display = "none";
          document.getElementById("items-grid").style.display = "block";

          console.log(`✅ ${allItems.length}個のアイテムを読み込みました`);
        } catch (error) {
          console.error("❌ アイテムデータの読み込みに失敗:", error);
          document.getElementById("items-loading").style.display = "none";
          document.getElementById("items-error").textContent =
            "アイテムデータの読み込みに失敗しました";
          document.getElementById("items-error").style.display = "block";
        }
      }

      // アイテムフィルター
      function filterItems() {
        const searchTerm = document
          .getElementById("item-search")
          .value.toLowerCase();
        const priceMin =
          parseInt(document.getElementById("item-price-min").value) || 0;
        const priceMax =
          parseInt(document.getElementById("item-price-max").value) || 999999;
        const selectedMap = document.getElementById("item-map").value;

        const filtered = allItems.filter((item) => {
          const matchesSearch =
            item.name.toLowerCase().includes(searchTerm) ||
            (item.plaintext &&
              item.plaintext.toLowerCase().includes(searchTerm));
          const matchesPrice =
            item.gold.total >= priceMin && item.gold.total <= priceMax;
          const matchesMap = item.maps[selectedMap] === true;
          const isPurchasable = item.gold.purchasable !== false;

          return matchesSearch && matchesPrice && matchesMap && isPurchasable;
        });

        displayItems(filtered);
      }

      // アイテム表示
      function displayItems(items) {
        const container = document.getElementById("items-grid");
        let html = '<div class="items-grid">';

        items.forEach((item) => {
          const imgUrl = `https://ddragon.leagueoflegends.com/cdn/${DDRAGON_VERSION}/img/item/${item.id}.png`;

          html += `
            <div class="item-card" onclick="showItemDetail('${item.id}')">
              <img src="${imgUrl}" alt="${item.name}" class="item-card-img" onerror="this.style.display='none'">
              <div class="item-card-name">${item.name}</div>
              <div class="item-card-price">${item.gold.total}G</div>
            </div>
          `;
        });

        html += "</div>";
        container.innerHTML = html;
      }

      // アイテム詳細表示
      function showItemDetail(itemId) {
        const item = allItems.find((i) => i.id === itemId);
        if (!item) return;

        let body = `
          <p><strong>価格:</strong> ${item.gold.total}G (売却: ${
          item.gold.sell
        }G)</p>
          ${
            item.plaintext
              ? `<p><strong>説明:</strong> ${item.plaintext}</p>`
              : ""
          }
          <br>
          <p><strong>効果:</strong></p>
          <p>${item.description.replace(/<[^>]*>/g, "")}</p>
        `;

        if (item.tags && item.tags.length > 0) {
          body += `<br><p><strong>タグ:</strong> ${item.tags.join(", ")}</p>`;
        }

        if (item.from && item.from.length > 0) {
          body += `<br><p><strong>作成素材:</strong> ${item.from.join(
            ", "
          )}</p>`;
        }

        if (item.into && item.into.length > 0) {
          body += `<br><p><strong>アップグレード先:</strong> ${item.into.join(
            ", "
          )}</p>`;
        }

        showModal(item.name, body);
      }

      // ページ読み込み時の初期化
      window.addEventListener("DOMContentLoaded", () => {
        loadChampions(); // フィルター用
        loadRunes();
        loadChampionsList();
        loadItemsList();
      });
    </script>
  </body>
</html>
